# 결과 통합 패턴

> 병렬 실행된 서브에이전트 결과를 효과적으로 통합하는 방법

---

## 1. 통합 전략 선택

```
[결과 유형 분석]
    │
    ├─ 동질적 결과 (같은 형태) ────→ 병합 전략
    │   예: 각 파일의 분석 결과
    │
    ├─ 이질적 결과 (다른 형태) ────→ 구조화 전략
    │   예: 탐색 + 분석 + 추천
    │
    └─ 투표/합의 필요 ─────────────→ 합의 전략
        예: 여러 관점의 리뷰
```

---

## 2. 병합 전략 (Merge)

동일한 형태의 결과를 하나로 합침.

### 단순 연결

```yaml
용도: 목록, 검색 결과

방법:
  1. 각 에이전트 결과 수집
  2. 리스트로 연결
  3. 중복 제거 (필요시)

예시:
  입력: [에이전트1: [A, B], 에이전트2: [C, D]]
  출력: [A, B, C, D]
```

### 우선순위 병합

```yaml
용도: 순위가 있는 결과

방법:
  1. 각 에이전트 결과에 점수/순위 포함
  2. 전체 결과 정렬
  3. 상위 N개 선택

예시:
  입력: [에이전트1: [(A, 0.9), (B, 0.7)],
         에이전트2: [(C, 0.8), (D, 0.6)]]
  출력: [(A, 0.9), (C, 0.8), (B, 0.7), (D, 0.6)]
```

### 키 기반 병합

```yaml
용도: 같은 대상에 대한 다른 속성

방법:
  1. 공통 키 식별
  2. 키별로 속성 병합
  3. 충돌 시 규칙 적용

예시:
  입력: [에이전트1: {fileA: {lines: 100}},
         에이전트2: {fileA: {functions: 5}}]
  출력: {fileA: {lines: 100, functions: 5}}
```

---

## 3. 구조화 전략 (Structure)

다른 유형의 결과를 논리적 구조로 조직.

### 섹션별 구조화

```yaml
용도: 다른 관점/측면의 분석

방법:
  1. 각 에이전트 역할 태그 부여
  2. 역할별 섹션으로 구성
  3. 요약 생성

출력 형식:
  ## 탐색 결과
  [에이전트1 결과]

  ## 분석 결과
  [에이전트2 결과]

  ## 요약
  [통합 요약]
```

### 계층적 구조화

```yaml
용도: 상위-하위 관계 결과

방법:
  1. 상위 결과 먼저 배치
  2. 하위 결과를 상위에 연결
  3. 트리 형태로 표현

출력 형식:
  - 모듈 A (에이전트1)
    - 함수 A1 (에이전트2)
    - 함수 A2 (에이전트3)
  - 모듈 B (에이전트1)
    - 함수 B1 (에이전트4)
```

### 타임라인 구조화

```yaml
용도: 순서가 있는 결과

방법:
  1. 타임스탬프/순서 정보 포함
  2. 시간순 정렬
  3. 마일스톤 표시

출력 형식:
  1. [Phase 1] 탐색 완료 - 10개 파일 발견
  2. [Phase 2] 분석 완료 - 3개 이슈 식별
  3. [Phase 3] 권장사항 생성 - 5개 제안
```

---

## 4. 합의 전략 (Consensus)

여러 관점에서 최선의 결론 도출.

### 다수결

```yaml
용도: 동일 질문에 여러 답변

방법:
  1. 각 에이전트 답변 수집
  2. 가장 빈번한 답변 선택
  3. 신뢰도 = 동의 비율

예시:
  입력: [에이전트1: "버그", 에이전트2: "버그", 에이전트3: "설계문제"]
  출력: "버그" (신뢰도: 67%)
```

### 가중 합의

```yaml
용도: 전문성이 다른 에이전트

방법:
  1. 에이전트별 가중치 부여
  2. 가중 평균/투표
  3. 최고 점수 선택

예시:
  보안에이전트(가중치 0.8): "취약점"
  일반에이전트(가중치 0.5): "정상"
  → 보안 관련 판단 우선
```

### 불일치 보고

```yaml
용도: 합의 불가 시

방법:
  1. 합의 임계값 설정 (예: 70%)
  2. 미달 시 모든 의견 제시
  3. 사용자 판단 요청

출력 형식:
  ⚠️ 에이전트 간 의견 불일치

  - 관점 A (2/4 에이전트): [내용]
  - 관점 B (2/4 에이전트): [내용]

  어떤 관점으로 진행할까요?
```

---

## 5. 결과 품질 처리

### 실패 처리

```yaml
# 일부 에이전트 실패 시
전략:
  - 성공한 결과만 사용
  - 실패 에이전트 태스크 재시도 (1회)
  - 부분 결과임을 명시

출력:
  ℹ️ 5개 중 4개 에이전트 완료
  [4개 결과 통합]

  ⚠️ 1개 에이전트 실패: [에러 내용]
```

### 빈 결과 처리

```yaml
# 결과 없는 에이전트
전략:
  - "결과 없음"도 정보로 취급
  - 다른 에이전트 결과에 영향 없음

출력:
  - 모듈 A: 3개 이슈 발견
  - 모듈 B: 이슈 없음 ✓
  - 모듈 C: 1개 이슈 발견
```

### 중복 제거

```yaml
# 여러 에이전트가 같은 결과
방법:
  - 정확히 일치: 하나만 유지
  - 유사: 가장 상세한 것 유지
  - 출처 표시 (선택적)

예시:
  원본: [A(에이전트1), A(에이전트2), B(에이전트3)]
  결과: [A, B]
```

---

## 6. 사용자 출력 형식

### 요약 우선

```markdown
## 요약
- 총 15개 파일 분석
- 7개 이슈 발견 (치명적 2, 경고 5)
- 주요 개선점: 에러 처리 강화

## 상세 결과
[펼쳐서 보기]
```

### 구조화된 테이블

```markdown
| 대상 | 상태 | 발견 사항 |
|------|------|----------|
| 모듈A | ⚠️ | 2개 이슈 |
| 모듈B | ✓ | 정상 |
| 모듈C | ❌ | 3개 이슈 |
```

### 액션 아이템

```markdown
## 다음 단계
1. [ ] moduleA.ts:42 - 널 체크 추가
2. [ ] moduleC.ts:15 - 에러 핸들링 개선
3. [ ] config.ts:8 - 환경변수 검증
```

---

## 7. 통합 예제

### 코드베이스 분석 통합

```
병렬 실행:
- 에이전트1: 파일 구조 탐색
- 에이전트2: 의존성 분석
- 에이전트3: 코드 품질 검사

통합 결과:
## 프로젝트 개요
[에이전트1 구조 + 에이전트2 의존성 병합]

## 품질 리포트
[에이전트3 결과]

## 권장사항
[3개 결과 종합 분석]
```

### 버그 조사 통합

```
병렬 실행:
- 에이전트1: 에러 로그 분석
- 에이전트2: 관련 코드 검토
- 에이전트3: 최근 커밋 확인

통합 결과:
## 근본 원인
[3개 관점 합의 또는 불일치 보고]

## 증거
- 로그: [에이전트1]
- 코드: [에이전트2]
- 변경 이력: [에이전트3]

## 수정 제안
[종합]
```
